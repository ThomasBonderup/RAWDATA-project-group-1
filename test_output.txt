-- GROUP: RAW1, MEMBERS: <Alex Tao Korsgaard Wogelius>, <Emilie Beske Unna-Lindhard>, <Nils Müllenborn>, <Thomas Winther Bonderup>
-- test script for testing function and procedures
SET search_path TO movie_data_model;
SET
-- D.1 Basic framework functionality
-- Test cases for user
SELECT add_user('ui000007', 'Test', 'User 07', 'test07@test.dk', '07pw', 'testuser07');
 add_user 
----------
 
(1 row)

SELECT update_user('ui000007', 'Test', 'Test 07.2', 'test07.2@test.dk', '07.2pw', 'testuser07.2');
 update_user 
-------------
 
(1 row)

SELECT delete_user('ui000007');
 delete_user 
-------------
 
(1 row)

-- Test cases for title bookmarks
SELECT add_title_bookmark('ui000002', 'tt9999991');
 add_title_bookmark 
--------------------
 
(1 row)

SELECT delete_title_bookmark('ui000002', 'tt9999991');
 delete_title_bookmark 
-----------------------
 
(1 row)

SELECT * from get_title_bookmarks('ui000002');
   uconst   |   tconst   
------------+------------
 ui000002   | tt9999994 
 ui000002   | tt9999993 
(2 rows)

-- Test cases for name bookmarks
SELECT add_name_bookmark('ui000002', 'nm3800107');
 add_name_bookmark 
-------------------
 
(1 row)

SELECT delete_name_bookmark('ui000002', 'nm3800107');
 delete_name_bookmark 
----------------------
 
(1 row)

SELECT * from get_name_bookmarks('ui000002');
   uconst   |   nconst   
------------+------------
 ui000002   | nm0000096 
 ui000002   | nm0000117 
 ui000002   | nm0000118 
(3 rows)

-- Test cases for title notes
SELECT add_title_notes('ui000002', 'tt9999991', 'This is a note lets see what i can write here 123, ***');
 add_title_notes 
-----------------
 
(1 row)

SELECT update_title_notes('ui000002', 'tt9999991', 'this is the updated title note');
 update_title_notes 
--------------------
 
(1 row)

SELECT delete_title_notes('ui000002', 'tt9999991');
 delete_title_notes 
--------------------
 
(1 row)

SELECT * from get_title_notes('ui000002');
   uconst   |   tconst   |          notes           
------------+------------+--------------------------
 ui000002   | tt9999999  | dummy t note ababc1xyzc4
 ui000002   | tt9999998  | dummy t note ababc1xyzc5
 ui000002   | tt9999997  | dummy t note abc1xyzabc6
 ui000002   | tt9999996  | dummy t note abcabc1xyz7
(4 rows)

-- Test cases for name notes
SELECT add_name_notes('ui000002', 'nm3800107', 'OG name note');
 add_name_notes 
----------------
 
(1 row)

SELECT update_name_notes('ui000002', 'tt9999991', 'this is the updated name note');
 update_name_notes 
-------------------
 
(1 row)

SELECT delete_name_notes('ui000002', 'nm3800107');
 delete_name_notes 
-------------------
 
(1 row)

SELECT * from get_name_notes('ui000002');
   uconst   |   nconst   |        notes         
------------+------------+----------------------
 ui000002   | nm0000226  | dummy n note abc4qwe
 ui000002   | nm0000171  | dummy n note abc5xyz
 ui000002   | nm0000178  | dummy n note abc6qwe
(3 rows)

-- Test case for get search history
SELECT * from get_search_history('ui000002');
   uconst   |           tstamp           |   search    
------------+----------------------------+-------------
 ui000002   | 2020-02-11 19:41:31.904682 | apples
 ui000002   | 2020-01-02 15:19:41.904682 | 2008
 ui000002   | 2020-07-06 16:42:41.904682 | rupert gint
(3 rows)

-- Test case for get rating history
SELECT * from get_rating_history('ui000002');
   uconst   |   tconst   |           tstamp           | rating |              review               
------------+------------+----------------------------+--------+-----------------------------------
 ui000002   | tt9999996  | 2020-09-08 16:23:11.904682 |      8 | this is a dummy review
 ui000002   | tt9999997  | 2020-09-09 18:19:11.904682 |      9 | i m to lazy to do a proper review
 ui000002   | tt9999995  | 2020-09-02 16:22:11.904682 |      4 | bad
 ui000002   | tt9999995  | 2020-03-09 12:39:11.904682 |      6 | ok
 ui000002   | tt9999995  | 2020-09-06 16:26:11.904682 |      8 | good
(5 rows)


-- D.2 Simple Search
-- Test case: find all movies with simple search with 1 parameter on title name or plot
--   	      select on search_history before an after to check if search string is stored
SELECT * FROM search_history;
   uconst   |           tstamp           |    search     
------------+----------------------------+---------------
 ui000001   | 2020-10-08 14:23:51.904682 | harry potter
 ui000001   | 2020-09-09 16:29:11.904682 | Dicaprio
 ui000002   | 2020-02-11 19:41:31.904682 | apples
 ui000002   | 2020-01-02 15:19:41.904682 | 2008
 ui000002   | 2020-07-06 16:42:41.904682 | rupert gint
 ui000003   | 2020-10-23 12:29:21.904682 | good place
 ui000003   | 2020-09-09 16:29:11.904682 | teeth
 ui000003   | 2020-02-11 19:41:31.904682 | limitless
 ui000003   | 2020-01-02 15:19:41.904682 | 2008
 ui000004   | 2020-07-06 16:42:41.904682 | skjdsdf
 ui000004   | 2020-10-23 12:29:21.904682 | agent 47
 ui000004   | 2020-09-09 16:29:11.904682 | 007
 ui000004   | 2020-02-11 19:41:31.904682 | james bond
 ui000005   | 2020-01-02 15:29:41.904682 | harrison ford
 ui000005   | 2020-07-06 16:42:41.904682 | indiana jones
 ui000006   | 2020-10-23 12:29:21.904682 | the blacklist
 ui000006   | 2020-09-02 11:44:51.904682 | the simpsons
(17 rows)


SELECT * FROM string_search('Remake', 'ui000001');
   tconst   |                          primarytitle                           
------------+-----------------------------------------------------------------
 tt0734731  | Shadow Play/Grace Note
 tt12266294 | Remakes, Remasters and Rereleases
 tt8874852  | Most Wanted HD Remakes
 tt3907180  | Remake, Remix, Rip-Off: About Copy Culture & Turkish Pop Cinema
 tt0245844  | The Count of Monte Cristo
 tt2028462  | 30 Anos de Chaves
 tt3716398  | Pokémon Alpha Sapphire
 tt5034320  | Kingdom Hearts HD 2.8 Final Chapter Prologue
 tt9839526  | The Legend of Zelda: Link's Awakening
 tt6027478  | Dhruva
 tt9844256  | Code Geass: Lelouch of the Rebellion III - Glorification
 tt0488478  | 12
 tt6057416  | Final Fantasy VII Remake
 tt7826034  | Resident Evil 2
 tt0334226  | Remake
 tt3520344  | Mysterious Disc
 tt5161760  | The Clown
 tt3716344  | Pokémon Omega Ruby
 tt7927838  | Shadow of the Colossus
 tt0734662  | The Mind and the Matter
 tt4997858  | Risen: The Story of Chron 'Hell Razah' Smith
 tt2431488  | Explode for Me
 tt2095753  | Rock Hunter in 3D
 tt7293238  | Remake
 tt10981530 | Peaky Blinders - Remake
 tt8598482  | Luigi's Mansion
(26 rows)


SELECT * FROM search_history;
   uconst   |           tstamp           |    search     
------------+----------------------------+---------------
 ui000001   | 2020-10-08 14:23:51.904682 | harry potter
 ui000001   | 2020-09-09 16:29:11.904682 | Dicaprio
 ui000002   | 2020-02-11 19:41:31.904682 | apples
 ui000002   | 2020-01-02 15:19:41.904682 | 2008
 ui000002   | 2020-07-06 16:42:41.904682 | rupert gint
 ui000003   | 2020-10-23 12:29:21.904682 | good place
 ui000003   | 2020-09-09 16:29:11.904682 | teeth
 ui000003   | 2020-02-11 19:41:31.904682 | limitless
 ui000003   | 2020-01-02 15:19:41.904682 | 2008
 ui000004   | 2020-07-06 16:42:41.904682 | skjdsdf
 ui000004   | 2020-10-23 12:29:21.904682 | agent 47
 ui000004   | 2020-09-09 16:29:11.904682 | 007
 ui000004   | 2020-02-11 19:41:31.904682 | james bond
 ui000005   | 2020-01-02 15:29:41.904682 | harrison ford
 ui000005   | 2020-07-06 16:42:41.904682 | indiana jones
 ui000006   | 2020-10-23 12:29:21.904682 | the blacklist
 ui000006   | 2020-09-02 11:44:51.904682 | the simpsons
 ui000001   | 2020-10-12 21:31:31.738182 | Remake
(18 rows)


-- D.3

-- Test case: Inserting a new (random) title rating to generate name ratings which is a trigger function
-- We should make an initial generate function as well, that isn't a trigger.
SELECT ins_user_rating('ui000001', 'tt9999996', 7);
 ins_user_rating 
-----------------
 
(1 row)


-- Test case: Displaying the name rating of an actor, to show that this will be updated alongside a title rating
SELECT *
FROM name_rating
WHERE nconst = 'nm99999999';
 nconst | primaryname | rating 
--------+-------------+--------
(0 rows)


-- Test case: Inserting a title rating on a movie which "stars" nm1449677 to see that his name rating changes
SELECT ins_user_rating('ui000002', 'tt9999999', 1);
 ins_user_rating 
-----------------
 
(1 row)


-- Test case: Showing that the name_rating of nm1449677 has changed
SELECT *
FROM name_rating
WHERE nconst = 'nm99999999';
 nconst | primaryname | rating 
--------+-------------+--------
(0 rows)


-- Test case: Updating a rating from the same user on the same movie.
-- The old rating will be subtracted from the average title rating and the new value will be updated.
SELECT upd_user_rating('ui000001', 'tt9999999', 10);
 upd_user_rating 
-----------------
 
(1 row)



-- Test case: Testing insert on user rating with review
SELECT ins_user_rating('ui000001', 'tt9999994', 8, 'Greatest movie I ever watched');
 ins_user_rating 
-----------------
 
(1 row)


-- Test case: Showing the result ofthe query above
SELECT *
FROM rating
WHERE tconst = 'tt9999994'  AND uconst = 'ui000001';
   uconst   |   tconst   | rating |            review             
------------+------------+--------+-------------------------------
 ui000001   | tt9999994  |      8 | Greatest movie I ever watched
(1 row)


-- Test case: Showing that the rating history is updated with inserts
SELECT *
FROM rating_history
WHERE uconst = 'ui000001';
   uconst   |   tconst   |           tstamp           | rating |                  review                  
------------+------------+----------------------------+--------+------------------------------------------
 ui000001   | tt9999999  | 2020-09-09 16:29:11.904682 |      7 | Awesome! best ever :)
 ui000001   | tt9999998  | 2020-03-05 14:37:11.904682 |      3 | Interesting, invigorating but funny 3/10
 ui000001   | tt9999997  | 2020-09-06 16:29:11.904682 |      7 | scary stuff, but still good
 ui000001   | tt9999997  | 2020-07-09 16:39:11.904682 |      8 | scary stuff, alright i guess
 ui000001   | tt9999996  | 2020-10-12 21:31:32.363505 |      7 | N/A
 ui000001   | tt9999999  | 2020-10-12 21:31:45.280031 |     10 | N/A
 ui000001   | tt9999994  | 2020-10-12 21:31:52.657359 |      8 | Greatest movie I ever watched
(7 rows)


-- Test case: Testing update on user ratings with review
SELECT upd_user_rating('ui000001', 'tt9999998', 4, 'I watched it again and changed my mind');
 upd_user_rating 
-----------------
 
(1 row)


-- Test case: Showing the result ofthe query above
SELECT *
FROM rating
WHERE tconst = 'tt9999998'  AND uconst = 'ui000001';
   uconst   |   tconst   | rating |                 review                 
------------+------------+--------+----------------------------------------
 ui000001   | tt9999998  |      4 | I watched it again and changed my mind
(1 row)


-- Test case: Showing that the rating history is updated with updates on title ratings
SELECT *
FROM rating_history
WHERE uconst = 'ui000001';
   uconst   |   tconst   |           tstamp           | rating |                  review                  
------------+------------+----------------------------+--------+------------------------------------------
 ui000001   | tt9999999  | 2020-09-09 16:29:11.904682 |      7 | Awesome! best ever :)
 ui000001   | tt9999998  | 2020-03-05 14:37:11.904682 |      3 | Interesting, invigorating but funny 3/10
 ui000001   | tt9999997  | 2020-09-06 16:29:11.904682 |      7 | scary stuff, but still good
 ui000001   | tt9999997  | 2020-07-09 16:39:11.904682 |      8 | scary stuff, alright i guess
 ui000001   | tt9999996  | 2020-10-12 21:31:32.363505 |      7 | N/A
 ui000001   | tt9999999  | 2020-10-12 21:31:45.280031 |     10 | N/A
 ui000001   | tt9999994  | 2020-10-12 21:31:52.657359 |      8 | Greatest movie I ever watched
 ui000001   | tt9999998  | 2020-10-12 21:31:59.678625 |      4 | I watched it again and changed my mind
(8 rows)




-- D.4 Structured String Search
-- Test case: find all movies with structured search with 4 parameters,
-- 	      title name, plot, characters and name,
-- 	      lower and upper case characters added including empty parameters
SELECT * FROM structured_string_search('', 'see', '', 'Mads miKKelsen', 'ui000001');
   tconst   | primarytitle  
------------+---------------
 tt0418455  | Adam's Apples
(1 row)


-- D.5 Actor Search
-- Test case: find all actor names with actor search with 1 parameter on actor name or character
SELECT * FROM actor_search('Mads Mikkelsen', 'ui000001');
   nconst   |  primaryname   
------------+----------------
 nm0586568  | Mads Mikkelsen
 nm0586568  | Mads Mikkelsen
 nm0586568  | Mads Mikkelsen
 nm0586568  | Mads Mikkelsen
(4 rows)


-- D.6
-- Test case: find the 12 actors that name co plays with (return table with primaryname and a count)
SELECT * from get_co_players('Clint Eastwood');
    primaryname     | count 
--------------------+-------
 Clint Eastwood     |     7
 Robert Lorenz      |     4
 Tom Stern          |     3
 Paul Haggis        |     2
 Bee Vang           |     1
 Bill Gerber        |     1
 Allan Glaser       |     1
 Christopher Carley |     1
 Angelina Jolie     |     1
 Brian Helgeland    |     1
 Colm Feore         |     1
 Brian Grazer       |     1
(12 rows)


-- D.7
-- Should generate all ratings for names
--SELECT generate_name_ratings();

-- D.8

-- D.9

-- D.10

-- D.11 Exact-match Querying
-- Test case D11a: find titles by searching on 3 intersecting keywords in inverted index wi
SELECT * FROM exact_match_search('apple', 'mads', 'mikkelsen', 'ui000001');
   tconst   | primarytitle  
------------+---------------
 tt0418455  | Adam's Apples
(1 row)


-- D.12 Best-match Querying
-- Test case D.12a: find ranked titles with multiple paramters by using VARIADIC array
SELECT * FROM dynamic_bestmatch('apple', 'mads', 'mikkelsen');
   tconst   | rank |                             title                             
------------+------+---------------------------------------------------------------
 tt0418455  |    3 | Adam's Apples
 tt0457655  |    2 | After the Wedding
 tt2106476  |    2 | The Hunt
 tt5807606  |    2 | Death Stranding
 tt0428441  |    1 | The Cutting Edge: The Magic of Movie Editing
 tt0439704  |    1 | Milk Can
 tt0449056  |    1 | Lick an Apple Like a Pussy: The Movie Stanislawski Never Made
 tt0495865  |    1 | Nandini
 tt0697753  |    1 | The Pie
 tt0758433  |    1 | The Person de Leo N.
 tt0765125  |    1 | Noget om Halfdan
 tt10055344 |    1 | NXT TakeOver: New York
 tt10131114 |    1 | Apple at Work - The Underdogs
 tt10283234 |    1 | Ratrir Jatri
 tt1040004  |    1 | Seducer's Fall
 tt1090643  |    1 | Att: Kasimir
 tt11213810 |    1 | Aurora: Apple Tree
 tt12066446 |    1 | Alan Walker & Ruben: Heading Home
 tt1217553  |    1 | ...Og det var Danmark
 tt12351942 |    1 | The Most Dangerous Concert Ever: The Morricone Duel
 tt1326214  |    1 | Downtown Calling
 tt1340454  |    1 | Our Neck of the Woods
 tt1385513  |    1 | The Distance Between the Apple and the Tree
 tt1568292  |    1 | The Buffalo Son
 tt1572002  |    1 | En stemme for livet
 tt1586732  |    1 | Death, Taxes and Apple Juice
 tt1735910  |    1 | The Capsule
 tt1784493  |    1 | King for Two Days
 tt1853535  |    1 | De genfødte
 tt1854312  |    1 | Music
 tt1928116  |    1 | Assassin's Creed: Revelations
 tt2036416  |    1 | You Are the Apple of My Eye
 tt2056563  |    1 | Easy Under the Apple Bough
 tt2104994  |    1 | Steve Jobs: The Lost Interview
 tt2132321  |    1 | Eden
 tt2342437  |    1 | Words of Captain Scott
 tt2435152  |    1 | The Loving Dead
 tt2560114  |    1 | Passio
 tt2836568  |    1 | Det røde eplet
 tt2995858  |    1 | Hitman
 tt3177386  |    1 | A Day in the Country
 tt3542412  |    1 | Erik & Else
 tt3615116  |    1 | Paradise Hotel
 tt3711064  |    1 | Deliver Us
 tt3980364  |    1 | Inside
 tt4011396  |    1 | Greed Eats the Soul
 tt4046102  |    1 | The Permaculture Orchard: Beyond Organic
 tt4130308  |    1 | An Island
 tt4321796  |    1 | Blue
 tt4499186  |    1 | Portrait of a Garden
 tt4643086  |    1 | Ávaxtakarfan
 tt4659056  |    1 | The Day Will Come
 tt4771548  |    1 | Apple: Backstage
 tt4997858  |    1 | Risen: The Story of Chron 'Hell Razah' Smith
 tt5316590  |    1 | For min datter
 tt5612428  |    1 | Sunless
 tt5709838  |    1 | Avatar: The Eagle Has Landed
 tt5801184  |    1 | Blindsided
 tt5816540  |    1 | Susanne Sundfør: Accelerate
 tt5890754  |    1 | The Taste of Apple
 tt6190908  |    1 | Hugo På Bas
 tt6202076  |    1 | Leaked
 tt6326340  |    1 | O' Bloody Night
 tt6441102  |    1 | Complicit
 tt6603666  |    1 | Maximillian
 tt6668018  |    1 | Påfugl Blant duer
 tt6746062  |    1 | Paradigm
 tt7010412  |    1 | The Great Buddha +
 tt7144150  |    1 | Det Glade Postbud
 tt7305820  |    1 | Past and Present
 tt7310086  |    1 | Deadline
 tt7313322  |    1 | Alpha and Omega
 tt8015190  |    1 | Apple iPhone 8 & iPhone X: Official Trailer - Parody
 tt8106994  |    1 | Welcome Home
 tt8346546  |    1 | Love Notes to Newton
 tt8525684  |    1 | Hitman 2
 tt8835200  |    1 | The In-Between
 tt8998634  |    1 | Maid in Hell
 tt9004986  |    1 | Syndebukken: Prosessen mot Harry Lindstrøm
 tt9150630  |    1 | Markets
 tt9460980  |    1 | Sunday
 tt9643290  |    1 | The Story of an Apple
 tt9665540  |    1 | De Hvi'
 tt9720546  |    1 | Løvernes Konge
 tt9720550  |    1 | The Goatkeeper
 tt9720554  |    1 | Run Sunday, Run
 tt9720558  |    1 | Mushi Mushi
 tt9720560  |    1 | The Lion King
 tt9720564  |    1 | Big Bowl
 tt0339723  |    1 | The Star Dreamer
 tt9720566  |    1 | Forhandleren
 tt0392787  |    1 | Nimbus '47
 tt0406282  |    1 | Bubbles
 tt0417459  |    1 | Back to Manhattan
(94 rows)


-- Test case D.12b: find ranked titles with single paramter by using VARIADIC array
SELECT * FROM dynamic_bestmatch('apple');
   tconst   | rank |                             title                             
------------+------+---------------------------------------------------------------
 tt0417459  |    1 | Back to Manhattan
 tt0418455  |    1 | Adam's Apples
 tt0428441  |    1 | The Cutting Edge: The Magic of Movie Editing
 tt0449056  |    1 | Lick an Apple Like a Pussy: The Movie Stanislawski Never Made
 tt0697753  |    1 | The Pie
 tt0758433  |    1 | The Person de Leo N.
 tt10055344 |    1 | NXT TakeOver: New York
 tt10131114 |    1 | Apple at Work - The Underdogs
 tt10283234 |    1 | Ratrir Jatri
 tt11213810 |    1 | Aurora: Apple Tree
 tt1326214  |    1 | Downtown Calling
 tt1385513  |    1 | The Distance Between the Apple and the Tree
 tt1568292  |    1 | The Buffalo Son
 tt1586732  |    1 | Death, Taxes and Apple Juice
 tt1735910  |    1 | The Capsule
 tt1784493  |    1 | King for Two Days
 tt1854312  |    1 | Music
 tt1928116  |    1 | Assassin's Creed: Revelations
 tt2036416  |    1 | You Are the Apple of My Eye
 tt2056563  |    1 | Easy Under the Apple Bough
 tt2104994  |    1 | Steve Jobs: The Lost Interview
 tt2132321  |    1 | Eden
 tt2435152  |    1 | The Loving Dead
 tt2836568  |    1 | Det røde eplet
 tt3177386  |    1 | A Day in the Country
 tt3615116  |    1 | Paradise Hotel
 tt3711064  |    1 | Deliver Us
 tt4011396  |    1 | Greed Eats the Soul
 tt4046102  |    1 | The Permaculture Orchard: Beyond Organic
 tt4499186  |    1 | Portrait of a Garden
 tt4643086  |    1 | Ávaxtakarfan
 tt4771548  |    1 | Apple: Backstage
 tt4997858  |    1 | Risen: The Story of Chron 'Hell Razah' Smith
 tt5612428  |    1 | Sunless
 tt5709838  |    1 | Avatar: The Eagle Has Landed
 tt5801184  |    1 | Blindsided
 tt5890754  |    1 | The Taste of Apple
 tt6441102  |    1 | Complicit
 tt6746062  |    1 | Paradigm
 tt7010412  |    1 | The Great Buddha +
 tt8015190  |    1 | Apple iPhone 8 & iPhone X: Official Trailer - Parody
 tt8106994  |    1 | Welcome Home
 tt8346546  |    1 | Love Notes to Newton
 tt9150630  |    1 | Markets
 tt9643290  |    1 | The Story of an Apple
(45 rows)


-- D.13
-- no solution
-- D.14
-- no solution
-- D.15
-- no solution
